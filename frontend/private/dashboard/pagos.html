<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pagos e Historial - Caminando Online</title>
  <link rel="icon" href="/assets/img/caminando-Favicon.png" type="image/png" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="/css/styles.css" />
  <link rel="stylesheet" href="/private/css/dashboard-styles.css" />
  <!-- Fonts para logo textual -->
  <link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:ital@1&display=swap" rel="stylesheet">
</head>

<body class="dashboard-body">
  <!-- Header del dashboard -->
  <header class="dashboard-header">
    <div class="header-container">
      <!-- Logo y navegaci√≥n principal -->
      <div class="header-left">
        <a href="/index.html" class="dashboard-logo-link">
          <img src="/assets/img/caminando-logo.png" alt="Logo Caminando Online" class="dashboard-logo" />
          <div class="dashboard-logo-text">
            <span class="logo-caminando-text">Caminando</span>
            <span class="logo-online-text">.Online</span>
          </div>
        </a>
      </div>

      <!-- Navegaci√≥n del dashboard -->
      <nav class="dashboard-nav">
        <ul class="nav-list">
          <li class="nav-item">
            <a href="/private/dashboard/dashboard.html" class="nav-link">
              <i class="nav-icon">üè†</i>
              <span>Dashboard</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="/index.html" class="nav-link">
              <i class="nav-icon">üîç</i>
              <span>Comparar</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="/private/dashboard/perfil.html" class="nav-link">
              <i class="nav-icon">üë§</i>
              <span>Perfil</span>
            </a>
          </li>
          <li class="nav-item active">
            <a href="/private/dashboard/pagos.html" class="nav-link">
              <i class="nav-icon">üí≥</i>
              <span>Pagos</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="/private/dashboard/supermercados.html" class="nav-link">
              <i class="nav-icon">üõí</i>
              <span>Supermercados</span>
            </a>
          </li>
        </ul>
      </nav>

      <!-- Men√∫ de usuario -->
      <div class="header-right">
        <div class="user-menu">
          <button class="user-menu-btn" id="user-menu-btn">
            <div class="user-avatar">
              <span id="user-initials">CU</span>
            </div>
            <span class="user-name" id="user-name">Cargando...</span>
            <i class="dropdown-arrow">‚ñº</i>
          </button>
          <div class="user-dropdown" id="user-dropdown">
            <div class="dropdown-header">
              <div class="user-info">
                <div class="user-email" id="user-email">usuario@email.com</div>
                <div class="user-status">Cuenta activa</div>
              </div>
            </div>
            <div class="dropdown-divider"></div>
            <a href="/private/dashboard/perfil.html" class="dropdown-item">
              <i class="item-icon">‚öôÔ∏è</i>
              Configuraci√≥n
            </a>
            <a href="#" class="dropdown-item" id="logout-btn">
              <i class="item-icon">üö™</i>
              Cerrar sesi√≥n
            </a>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Contenido principal -->
  <main class="dashboard-main">
    <div class="dashboard-container">
      
      <!-- Encabezado de la p√°gina -->
      <div class="page-header">
        <h1 class="page-title">Pagos e Historial</h1>
        <p class="page-subtitle">Gestion√° tus m√©todos de pago y consult√° tu historial de compras</p>
      </div>

      <!-- Resumen de estad√≠sticas -->
      <section class="payments-summary">
        <div class="row">
          <div class="col-md-3 col-6 mb-3">
            <div class="stat-card stat-card-primary">
              <div class="stat-icon">üí∞</div>
              <div class="stat-content">
                <div class="stat-value" id="total-gastado">$0</div>
                <div class="stat-label">Total gastado</div>
              </div>
            </div>
          </div>
          <div class="col-md-3 col-6 mb-3">
            <div class="stat-card stat-card-success">
              <div class="stat-icon">üéØ</div>
              <div class="stat-content">
                <div class="stat-value" id="total-ahorrado">$0</div>
                <div class="stat-label">Total ahorrado</div>
              </div>
            </div>
          </div>
          <div class="col-md-3 col-6 mb-3">
            <div class="stat-card stat-card-info">
              <div class="stat-icon">üõçÔ∏è</div>
              <div class="stat-content">
                <div class="stat-value" id="compras-mes">0</div>
                <div class="stat-label">Compras este mes</div>
              </div>
            </div>
          </div>
          <div class="col-md-3 col-6 mb-3">
            <div class="stat-card stat-card-warning">
              <div class="stat-icon">üìà</div>
              <div class="stat-content">
                <div class="stat-value" id="promedio-ahorro">0%</div>
                <div class="stat-label">Ahorro promedio</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <div class="payments-grid">
        
        <!-- M√©todos de Pago -->
        <section class="dashboard-card payment-methods-card">
          <div class="card-header">
            <h3 class="card-title">M√©todos de Pago</h3>
            <button class="btn btn-outline-primary btn-sm" id="add-payment-method-btn">
              <i class="btn-icon">+</i>
              Agregar
            </button>
          </div>
          <div class="card-body">
            <div class="payment-methods-list" id="payment-methods-list">
              <div class="empty-state">
                <div class="empty-icon">üí≥</div>
                <div class="empty-text">
                  <div class="empty-title">No hay m√©todos de pago guardados</div>
                  <div class="empty-subtitle">Agreg√° una tarjeta o cuenta para realizar compras</div>
                </div>
                <button class="btn btn-outline-primary btn-sm" id="add-first-payment-btn">
                  Agregar m√©todo de pago
                </button>
              </div>
            </div>
          </div>
        </section>

        <!-- Filtros de historial -->
        <section class="dashboard-card filters-card">
          <div class="card-header">
            <h3 class="card-title">Filtrar Historial</h3>
          </div>
          <div class="card-body">
            <form id="filters-form" class="filters-form">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="filter-fecha-desde" class="form-label">Desde</label>
                  <input type="date" class="form-control" id="filter-fecha-desde" name="fechaDesde">
                </div>
                <div class="col-md-6 mb-3">
                  <label for="filter-fecha-hasta" class="form-label">Hasta</label>
                  <input type="date" class="form-control" id="filter-fecha-hasta" name="fechaHasta">
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="filter-supermercado" class="form-label">Supermercado</label>
                  <select class="form-select" id="filter-supermercado" name="supermercado">
                    <option value="">Todos</option>
                    <option value="carrefour">Carrefour</option>
                    <option value="disco">Disco</option>
                    <option value="jumbo">Jumbo</option>
                    <option value="vea">Vea</option>
                    <option value="dia">D√≠a</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="filter-estado" class="form-label">Estado</label>
                  <select class="form-select" id="filter-estado" name="estado">
                    <option value="">Todos</option>
                    <option value="pendiente">Pendiente</option>
                    <option value="procesando">Procesando</option>
                    <option value="confirmado">Confirmado</option>
                    <option value="entregado">Entregado</option>
                    <option value="cancelado">Cancelado</option>
                  </select>
                </div>
              </div>
              <div class="filters-actions">
                <button type="submit" class="btn btn-primary btn-sm">
                  <i class="btn-icon">üîç</i>
                  Aplicar filtros
                </button>
                <button type="button" class="btn btn-outline-secondary btn-sm" id="clear-filters-btn">
                  Limpiar
                </button>
              </div>
            </form>
          </div>
        </section>

      </div>

      <!-- Historial de Compras -->
      <section class="dashboard-card purchases-history-card">
        <div class="card-header">
          <h3 class="card-title">Historial de Compras</h3>
          <div class="card-actions">
            <button class="btn btn-outline-secondary btn-sm" id="export-history-btn">
              <i class="btn-icon">üì•</i>
              Exportar
            </button>
          </div>
        </div>
        <div class="card-body">
          <div class="purchases-list" id="purchases-list">
            <div class="empty-state">
              <div class="empty-icon">üõçÔ∏è</div>
              <div class="empty-text">
                <div class="empty-title">No hay compras registradas</div>
                <div class="empty-subtitle">¬°Realiz√° tu primera compra para ver el historial aqu√≠!</div>
              </div>
              <a href="/index.html" class="btn btn-outline-primary btn-sm">
                Comparar productos
              </a>
            </div>
          </div>
          
          <!-- Paginaci√≥n -->
          <div class="pagination-wrapper" id="pagination-wrapper" style="display: none;">
            <nav>
              <ul class="pagination justify-content-center">
                <li class="page-item">
                  <button class="page-link" id="prev-page-btn">Anterior</button>
                </li>
                <li class="page-item active">
                  <span class="page-link" id="current-page">1</span>
                </li>
                <li class="page-item">
                  <button class="page-link" id="next-page-btn">Siguiente</button>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </section>

    </div>
  </main>

  <!-- Modal para agregar m√©todo de pago -->
  <div class="modal fade" id="paymentMethodModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Agregar M√©todo de Pago</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          
          <!-- Selector de tipo de pago -->
          <div class="payment-type-selector mb-4">
            <div class="row">
              <div class="col-4">
                <input type="radio" class="btn-check" name="payment-type" id="payment-type-card" value="tarjeta" checked>
                <label class="btn btn-outline-primary w-100" for="payment-type-card">
                  <div class="payment-type-icon">üí≥</div>
                  <div class="payment-type-text">Tarjeta</div>
                </label>
              </div>
              <div class="col-4">
                <input type="radio" class="btn-check" name="payment-type" id="payment-type-mercadopago" value="mercadopago">
                <label class="btn btn-outline-primary w-100" for="payment-type-mercadopago">
                  <div class="payment-type-icon">üîµ</div>
                  <div class="payment-type-text">MercadoPago</div>
                </label>
              </div>
              <div class="col-4">
                <input type="radio" class="btn-check" name="payment-type" id="payment-type-modo" value="modo">
                <label class="btn btn-outline-primary w-100" for="payment-type-modo">
                  <div class="payment-type-icon">üü£</div>
                  <div class="payment-type-text">MODO</div>
                </label>
              </div>
            </div>
          </div>

          <!-- Formulario de tarjeta -->
          <form id="payment-method-form">
            <div id="card-form" class="payment-form">
              <div class="mb-3">
                <label for="card-alias" class="form-label">Alias de la tarjeta *</label>
                <input type="text" class="form-control" id="card-alias" name="alias" placeholder="Ej: Visa personal">
                <div class="error-message" id="error-card-alias"></div>
              </div>
              <div class="mb-3">
                <label for="card-number" class="form-label">N√∫mero de tarjeta *</label>
                <input type="text" class="form-control" id="card-number" name="numero" placeholder="1234 5678 9012 3456" maxlength="19">
                <div class="error-message" id="error-card-number"></div>
              </div>
              <div class="row">
                <div class="col-6 mb-3">
                  <label for="card-expiry" class="form-label">Vencimiento *</label>
                  <input type="text" class="form-control" id="card-expiry" name="vencimiento" placeholder="MM/AA" maxlength="5">
                  <div class="error-message" id="error-card-expiry"></div>
                </div>
                <div class="col-6 mb-3">
                  <label for="card-cvc" class="form-label">CVC *</label>
                  <input type="text" class="form-control" id="card-cvc" name="cvc" placeholder="123" maxlength="4">
                  <div class="error-message" id="error-card-cvc"></div>
                </div>
              </div>
              <div class="mb-3">
                <label for="card-holder" class="form-label">Titular de la tarjeta *</label>
                <input type="text" class="form-control" id="card-holder" name="titular" placeholder="Nombre como aparece en la tarjeta">
                <div class="error-message" id="error-card-holder"></div>
              </div>
              <div class="mb-3">
                <label for="card-bank" class="form-label">Banco</label>
                <select class="form-select" id="card-bank" name="banco">
                  <option value="">Seleccionar banco...</option>
                  <option value="santander">Santander</option>
                  <option value="bbva">BBVA</option>
                  <option value="galicia">Galicia</option>
                  <option value="macro">Macro</option>
                  <option value="nacion">Banco Naci√≥n</option>
                  <option value="provincia">Banco Provincia</option>
                  <option value="ciudad">Banco Ciudad</option>
                  <option value="otro">Otro</option>
                </select>
              </div>
            </div>

            <!-- Formulario de MercadoPago -->
            <div id="mercadopago-form" class="payment-form" style="display: none;">
              <div class="mb-3">
                <label for="mp-alias" class="form-label">Alias *</label>
                <input type="text" class="form-control" id="mp-alias" name="alias" placeholder="Ej: MercadoPago personal">
              </div>
              <div class="mb-3">
                <label for="mp-email" class="form-label">Email de MercadoPago *</label>
                <input type="email" class="form-control" id="mp-email" name="email" placeholder="tu@email.com">
                <small class="form-text text-muted">Usaremos este email para procesar los pagos</small>
              </div>
            </div>

            <!-- Formulario de MODO -->
            <div id="modo-form" class="payment-form" style="display: none;">
              <div class="mb-3">
                <label for="modo-alias" class="form-label">Alias *</label>
                <input type="text" class="form-control" id="modo-alias" name="alias" placeholder="Ej: MODO personal">
              </div>
              <div class="mb-3">
                <label for="modo-cbu" class="form-label">CBU/CVU *</label>
                <input type="text" class="form-control" id="modo-cbu" name="cbu" placeholder="0000003100010000000001" maxlength="22">
                <small class="form-text text-muted">N√∫mero de CBU o CVU asociado a MODO</small>
              </div>
            </div>

            <!-- Opciones comunes -->
            <div class="form-check mb-3">
              <input class="form-check-input" type="checkbox" id="payment-is-default" name="esPrincipal">
              <label class="form-check-label" for="payment-is-default">
                Usar como m√©todo de pago principal
              </label>
            </div>
            
            <div class="form-check mb-3">
              <input class="form-check-input" type="checkbox" id="payment-remember" name="recordarDatos">
              <label class="form-check-label" for="payment-remember">
                Recordar esta informaci√≥n para pr√≥ximas compras
              </label>
            </div>
          </form>

          <!-- Nota de seguridad -->
          <div class="alert alert-info">
            <strong>üîí Informaci√≥n segura:</strong> Tus datos de pago est√°n protegidos con encriptaci√≥n de nivel bancario. No almacenamos n√∫meros de tarjeta completos.
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-primary" id="save-payment-method-btn">
            <span class="btn-text">Guardar m√©todo de pago</span>
            <span class="btn-loading" style="display: none;">
              <span class="spinner-border spinner-border-sm me-2"></span>
              Guardando...
            </span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de detalles de compra -->
  <div class="modal fade" id="purchaseDetailsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Detalles de la Compra</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body" id="purchase-details-content">
          <!-- Contenido din√°mico -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
          <button type="button" class="btn btn-primary" id="reorder-btn">
            <i class="btn-icon">üîÑ</i>
            Comprar nuevamente
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/js/auth/auth-utils.js"></script>
  <script src="/js/components/auth-manager.js"></script>
  <script src="/js/dashboard/dashboard-main.js"></script>
  <script src="/js/dashboard/pagos-historial.js"></script>
  
  <!-- Inicializar AuthManager -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      if (window.AuthManager) {
        window.AuthManager.inicializar();
        console.log('‚úÖ AuthManager inicializado en pagos');
      }
    });
  </script>
</body>
</html>